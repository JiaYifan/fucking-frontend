## 什么是垃圾

- 没有被引用的对象就是垃圾
- 如果几个对象引用形成一个环，但根访问不到它们，也是垃圾。

## 可达性

如果引用或引用链可以从 **根** 访问任何其他值，则认为该值是可访问的。

> 根

- 本地函数的局部变量和参数
- 当前嵌套调用链上的其他函数的变量和参数
- 全局变量
- 还有一些其他的，内部的

如果局部变量中有对象，并且该对象具有引用另一个对象的属性，则该对象被视为可达性， 它引用的那些也是可以访问的。

## 标记-清除

从根开始通过引用访问到所有可达的结点，那些不可达的将被删除

## 一些优化

### V8 新生代老生代

- 新生代，指的是新产生的对象；老生代就是经历过新生代垃圾回收后还“存活”下来的对象
- 新生代里分为 From 和 To 两个空间，新对象被分配到 From，通过 BFS 从根遍历可访问对象，并将其移动到 To，不可达的将被清除。多次复制仍然存活的对象会被移动到老生代。
- 老生代采用标记清除算法，老生代不会经常进行检查

### 增量标记（Incremental Marking）

- 在垃圾回收时都需要将正在执行的 JavaScript 应用逻辑暂停下来，待垃圾回收完毕后再恢复。这种行为叫作“全停顿”（stop-the-world）。
- 在 V8 新生代的分代回收中，只收集新生代，而新生代通常配置较小，且存活对象较少，所以全停顿的影响不大，而老生代就相反了。
- 为了降低全部老生代全堆垃圾回收带来的停顿时间，V8 将标记过程分为一个个的子标记过程，同时让垃圾回收标记和 JS 应用逻辑交替进行，直到标记阶段完成。

## 内存泄漏

1. 滥用缓存、闭包、全局变量
2. React 中定时器、事件监听没有在组件销毁时销毁
3. 无效的 DOM 引用 `const a = getElementById`

## 引用

> [前端面试：谈谈 JS 垃圾回收机制](https://zhuanlan.zhihu.com/p/60279001)

> [垃圾回收](https://zh.javascript.info/garbage-collection)

> [JS 探索-GC 垃圾回收](https://zhuanlan.zhihu.com/p/103110917)
